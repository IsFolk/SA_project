<!DOCTYPE html>
<html>
	<head>
		<title>OWL MY CLASS</title>
		<meta charset="utf-8">
		<base href="">
		<link rel="icon" type="image/png" href="">
		<link href="" type="text/css" rel="stylesheet">
		<link href="../../../css_files/general.css" type="text/css" rel="stylesheet">
		<style>

		</style>
	</head>
	<body>
		<!--畫面最上方的橫條navbar-->
		<nav>
			<div class="container">
				<div class="navbar-header">
					<img src="" alt="logo">
					<span class="text">OWL MY CLASS</span>
				</div>
				<div class="navbar-collapse">
					<ul class="navbar-right">
						<li>
							<div class="homebtn">
								<a href="#"><span class="text">我的主頁</span></a>
							</div>
						</li>
						<li class="dropdown-btn">
							<a href="#" tabindex="0"><img src="" alt="img"></a>
							<ul class="dropdown-menu">
								<li>
									<a href="#"><span class="text">個人資訊</span></a>
								</li>
								<li>
									<a href="#"><span class="text">登出</span></a>		
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<!--橫幅-->
		<div class="banner">
			<div class="container">
				<img src="" alt="img">
					<span class="banner-name course-name text-bold"></span>
					<span class="banner-extInfo course-code"></span>
			</div>
		</div>

		<!--下半部分-->
		<div class="lowerhalf">
			<div class="container">
				<!--左下的選單-->
				<div class="test-sidebar-container">
					<div class="test-sidebar">
						<ul class="test-sidebar-menu">
							<li>
								<a href="addTestInfo.html"><span class="text">測驗資訊</span></a>
							</li>
							<li class="currentpage">
								<a href="#"><span class="text">第</span><span class="text question-order"></span><span class="text">題</span></a>
							</li>
						</ul>
						<a href="#"><span class="text add-question-btn">+ 新增題目</span></a>
					</div>
				</div>
			<!--右下區域-->
				<div class="content-right">
					<div class="content-right-title">
						<span class="text-bold">編輯題目</span>
					</div>
					<div class="hr"></div>
					<form>
						<table class="form-tbl">
							<tr><td><span class="text-bold question-order"></span><span class="text-bold">.</span></td></tr>
							<tr>
								<td></td>
								<td><textarea class="round-border blue-border" id="question" name="question" placeholder="題目敘述" rows="6"></textarea></td>
								<td>
									<select class="round-border blue-border" id="slt">
										<option value=".ans_1">單選題</option>
										<option value=".ans_2">多選題</option>
										<option value=".ans_3">簡答題</option>
									</select>
									<br><br>
									<input type="file" id="input-img" accept=".jpg, .png, .jpeg">
								</td>
							</tr>
							<tr>
								<td></td>
								<td colspan="2" class="uploaded-img"><img id="preview-img" src="" width="50%"/></td>
							</tr>
							<tr>
								<td></td>
								<td id="ans_td">
									<div>
										<span class="text-reminder">(請選取正確選項)</span>
										<ol class="ans_1_list">
											<li>
												<input class="ans1" type="radio" name="choices" value="1">
												<textarea class="choice1" name="choice" rows="1"></textarea>
											</li>
											<li>
												<input class="ans2" type="radio" name="choices" value="1">
												<textarea class="choice2" name="choice" rows="1"></textarea>
											</li>
											<li>
												<input class="ans3" type="radio" name="choices" value="1">
												<textarea class="choice3" name="choice" rows="1"></textarea>
											</li>
											<li>
												<input class="ans4" type="radio" name="choices" value="1">
												<textarea class="choice4" name="choice" rows="1"></textarea>
											</li>
										</ol>
									</div>
								</td>
							</tr>
						</table>
						<input type="submit" id="submit_btn" class="submit-btn round-border" value="完成編輯">
					</form>
				</div>
			</div>
		</div>

		<div class="do-not-show">
			<div class="ans_1">
				<span class="text-reminder">(請選取正確選項)</span>
				<ol class="ans_1_list_default">
					<li>
						<input class="a1" type="radio" name="" value="1">
						<textarea class="c1" name="choice" rows="1"></textarea>
					</li>
					<li>
						<input class="a2" type="radio" name="" value="1">
						<textarea class="c2" name="choice" rows="1"></textarea>
					</li>
					<li>
						<input class="a3" type="radio" name="" value="1">
						<textarea class="c3" name="choice" rows="1"></textarea>
					</li>
					<li>
						<input class="a4" type="radio" name="" value="1">
						<textarea class="c4" name="choice" rows="1"></textarea>
					</li>
				</ol>
			</div>
			<div class="ans_2">
				<span class="text-reminder">(請選取正確選項)</span>
				<ol class="ans_2_list_default">
					<li>
						<input class="a1" type="checkbox" name="" value="1">
						<textarea class="c1" name="choice" rows="1"></textarea>
					</li>
					<li>
						<input class="a2" type="checkbox" name="" value="1">
						<textarea class="c2" name="choice" rows="1"></textarea>
					</li>
					<li>
						<input class="a3" type="checkbox" name="" value="1">
						<textarea class="c3" name="choice" rows="1"></textarea>
					</li>
					<li>
						<input class="a4" type="checkbox" name="" value="1">
						<textarea class="c4" name="choice" rows="1"></textarea>
					</li>
				</ol>
			</div>
			<div class="ans_3"></div>
		</div>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="../../../js_files/general.js"></script>
		<script src="../../../js_files/test.js"></script>
		<script>
		/////////第N題//////////////////
var questionNumber = 1;
$(".question-order").text(questionNumber);
///////////////////////////////////

////////////select////////////////////
var div3_is_not_showing = 1;
$(function(){
	
	
	var sltValue = ".ans_1";
	$('#slt').change(function(){
		sltValue = $(this).val();
		$('#ans_td').empty();
		$(sltValue).clone().appendTo($('#ans_td'));
		
		$('#ans_td .c1').attr('class', 'choice1');
		$('#ans_td .c2').attr('class', 'choice2');
		$('#ans_td .c3').attr('class', 'choice3');
		$('#ans_td .c4').attr('class', 'choice4');
		
		$('#ans_td .a1').attr('class', 'ans1');
		$('#ans_td .a2').attr('class', 'ans2');
		$('#ans_td .a3').attr('class', 'ans3');
		$('#ans_td .a4').attr('class', 'ans4');
		
		if(sltValue == '.ans_3'){
			div3_is_not_showing = 0;
		}
	});
});
///////////////////////////////
//////////////preview img/////////
$("#input-img").change(function(){
	readURL(this);
});

function readURL(input){
  if(input.files && input.files[0]){
    var reader = new FileReader();
    reader.onload = function (e) {
		$("#preview-img").attr('src', e.target.result);
    }
    reader.readAsDataURL(input.files[0]);
  }
}

/////////////////submit/////////////////////////
$('#submit_btn').click(function(){
	submit();
});
		
function submit() {
	var question_detail = $('#question').val();
	var choice_1 = $('.choice1').val();
	var choice_2 = $('.choice2').val();
	var choice_3 = $('.choice3').val();
	var choice_4 = $('.choice4').val();
	var ans_1 = '';
	var ans_2 = '';
	var ans_3 = '';
	var ans_4 = '';
	var check1 = $("input[class=ans1]:checked").val()
	if(check1 == 1){
		ans_1 += choice_1;
	}
	var check2 = $("input[class=ans2]:checked").val()
	if(check2 == 1){
		ans_2 += choice_2;
	}
	var check3 = $("input[class=ans3]:checked").val()
	if(check3 == 1){
		ans_3 += choice_3;
	}
	var check4 = $("input[class=ans4]:checked").val()
	if(check4 == 1){
		ans_4 += choice_4;
	}

	if (question_detail == ''){
		alert("請輸入題目!");
	}else if(choice_1 == ''){
		alert("請至少輸入選項一!");
	}
	else if((ans_1+ans_2+ans_3+ans_4 == '')&&(div3_is_not_showing == 1)){
		alert("請選取正確答案!");
	}else{
		//將資料轉成JSON格式
		var data_object = {
			"QuestionText": question_detail,
			"OptionA":　ans_1,
			"OptionB":　ans_2,
			"OptionC":　ans_3,
			"OptionD":　ans_4,
		};
		//將JSON格式轉成字串
		var data_string = JSON.stringify(data_object);
		//發出POST的AJAX請求
		$.ajax({
			type: "POST",
			url: "api/test.do",
			data: data_string,
			crossDomain: true,
			cache: false,
			dataType: 'json',
			timeout: 5000,
			success: function(response){
				if(response.status == 200){
					alert("上傳成功!");
				}
			},
			error: function(){
				alert("無法連線到伺服器!");
			}
		});
	}
}

		</script>
	</body>
</html>
