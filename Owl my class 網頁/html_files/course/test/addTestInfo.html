<!DOCTYPE html>
<html>
	<head>
		<title>OWL MY CLASS</title>
		<meta charset="utf-8">
		<base href="">
		<link rel="icon" type="image/png" href="">
		<link href="" type="text/css" rel="stylesheet">
		<link href="../../../css_files/general.css" type="text/css" rel="stylesheet">
	</head>
	<body>
		<!--畫面最上方的橫條navbar-->
		<nav>
			<div class="container">
				<div class="navbar-header">
					<img src="" alt="logo">
					<span class="text">OWL MY CLASS</span>
				</div>
				<div class="navbar-collapse">
					<ul class="navbar-right">
						<li>
							<div class="homebtn">
								<a href="#"><span class="text">我的主頁</span></a>
							</div>
						</li>
						<li class="dropdown-btn">
							<a href="#" tabindex="0"><img src="" alt="img"></a>
							<ul class="dropdown-menu">
								<li>
									<a href="#"><span class="text">個人資訊</span></a>
								</li>
								<li>
									<a href="#"><span class="text">登出</span></a>		
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<!--橫幅-->
		<div class="banner">
			<div class="container">
				<img src="" alt="img">
					<span class="banner-name course-name text-bold"></span>
					<span class="banner-extInfo course-code"></span>
			</div>
		</div>

		<!--下半部分-->
		<div class="lowerhalf">
			<div class="container">
				<!--左下的選單-->
				<div class="test-sidebar-container">
					<div class="test-sidebar">
						<ul class="test-sidebar-menu">
							<li class="currentpage">
								<a href="addTestInfo.html"><span class="text">測驗資訊</span></a>
							</li>
							<li>
								<a href="addTestQuestion.html"><span id="add_question">新增題目</span></a>
							</li>
						</ul>
						
					</div>
				</div>
			<!--右下區域-->
				<div class="content-right">
					<div class="content-right-title">
						<span class="text-bold">編輯測驗資訊</span>
					</div>
					<div class="hr"></div>
					<form>
						<table class="form-tbl">
							<tbody>
								<tr>
									<td class="tr-title"><span class="text-bold">標題</span></td>
									<td><input class="round-border blue-border blue-border" id="test_name" name="title" placeholder="測驗標題" type="text"></td>
								</tr>
								<tr>
									<td class="tr-title"><span class="text-bold">開放時間</span></td>
									<td><input class="round-border blue-border blue-border" id="opening_date" type="date">&ensp;&ensp;<input class="round-border blue-border blue-border" id="opening_time" type="time"></td>
								</tr>
								<tr>
									<td class="tr-title"><span class="text-bold">關閉時間</span></td>
									<td><input class="round-border blue-border" id="ending_date" type="date">&ensp;&ensp;<input class="round-border blue-border blue-border" id="ending_time" type="time"></td>
								</tr>
								<tr>
									<td class="tr-title"><span class="text-bold">說明</span></td>
									<td><textarea class="round-border blue-border" id="test_detail" name="description" placeholder="測驗說明"></textarea></td>
								</tr>
							</tbody>
						</table>
						<input id="submit_btn" type="submit" class="submit-btn round-border" value="完成編輯">
					</form>
				</div>
			</div>
		</div>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="../../../js_files/test.js"></script>
		<script>

$('#test_name').attr("value", "測驗一");
$('#opening_date').attr("value",'2022-01-03');
$('#opening_time').attr("value",'08:30');
$('#ending_date').attr("value",'2022-01-03');
$('#ending_time').attr("value",'09:30');
$('#test_detail').text("測驗說明");
///////////////side bar//////////////////////
$.ajax({
	type: "GET",
	url: "api/Question.do",
	crossDomain: true,
	cache: false,
	dataType: 'json',
	timeout: 5000,
	success: function (response) {
		if(response.status == 200){
			updateSidebar(response.response.data);
		}
	},
	error: function () {
		alert("無法連線到伺服器！");
	}
});




function updateSidebar(data) {
	var sidebar_list = '';
	$.each(data, function(index, value) {
		sidebar_list += '<li>';
		sidebar_list += '<a href="editTestQuestion.html">' ;
		sidebar_list += '<span id="' + value['id'] + '">第' + (value['id']+1) + '題</span>';
		sidebar_list += '</a>' ;
		sidebar_list += '</li>';
	})

	$(".test-sidebar-menu").append(sidebar_list);
}


////////////////////////////////////////////////////
$('#submit_btn').click(function(){
	submit();
});

$('#add_question').click(function(){
	addQuestion();
});
		
function submit() {
	var test_name = $('#test_name').val();
	var opentime_input = $('#opening_date').val() + ' ' + $('#opening_time').val() + ':00';
	var endtime_input = $('#ending_date').val() + ' ' + $('#ending_time').val() + ':00';
	var test_detail = $('#test_detail').val();
	
	if (test_name == ''){
		alert("請輸入測驗標題!");
	}else if((opening_time == '')||(ending_time == '')){
		alert("請輸入測驗時間!");
	}else{
		//將資料轉成JSON格式
		var data_object = {
			"TestName": test_name,
			"TestDetail":　test_detail,
			"OpeningTime": opentime_input,
			"EndingTime": endtime_input,
		};
		//將JSON格式轉成字串
		var data_string = JSON.stringify(data_object);
		//發出POST的AJAX請求
		$.ajax({
			type: "POST",
			url: "api/test.do",
			data: data_string,
			crossDomain: true,
			cache: false,
			dataType: 'json',
			timeout: 5000,
			success: function(response){
				if(response.status == 200){
					alert("上傳成功!");
				}
			},
			error: function(){
				alert("無法連線到伺服器!");
			}
		});
	}
}

function addQuestion(){
	
}
		</script>
		<script src="../../../js_files/general.js"></script>
	</body>
</html>
