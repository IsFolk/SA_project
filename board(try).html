<!DOCTYPE html>
<html>
	<head>
		<title>OWL MY CLASS</title>
		<meta charset="utf-8">
		<base href="">
		<link rel="icon" type="image/png" href="">
		<link href="css_files/general.css" type="text/css" rel="stylesheet">
		<link href="css_files/board.css" type="text/css" rel="stylesheet">
		<script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
	</head>
	<body>
		<!--畫面最上方的橫條navbar-->
		<nav>
			<div class="container">
				<div class="navbar-header">
					<img src="" alt="logo">
					<span class="text">OWL MY CLASS</span>
				</div>
				<div class="navbar-collapse">
					<ul class="navbar-right">
						<li>
							<div class="homebtn">
								<a href="#"><span class="text">我的主頁</span></a>
							</div>
						</li>
						<li class="dropdown-btn">
							<a href="#" tabindex="0"><img src="" alt="img"></a>
							<ul class="dropdown-menu">
								<li>
									<a href="#"><span class="text">個人資訊</span></a>
								</li>
								<li>
									<a href="#"><span class="text">登出</span></a>		
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<!--橫幅-->
		<div class="banner">
			<div class="container">
				<img src="" alt="img">
					<span class="banner-name course-name text-bold"></span>
					<span class="banner-extInfo course-code"></span>
			</div>
		</div>

		<!--下半部分-->
		<div class="lowerhalf">
			<div class="container">
				<!--左下的選單-->
				<div class="sidebar">
					<div class="professor">
						<span class="text-bold">教授:</span><span class="text-bold course-professor"></span>
					</div>
					<ul class="sidebar-menu">
						<li>
							<a href="../info/info.html"><span class="text">課程資訊</span></a>
						</li>
						<li class="currentpage">
							<a href="board.html"><span class="text">課程公告</span></a>
						</li>
						<li>
							<a href="../textbook/textbookList.html"><span class="text">課程教材</span></a>
						</li>
						<li>
							<a href="../homework/homeworkList.html"><span class="text">作業</span></a>
						</li>
						<li>
							<a href="../test/testList.html"><span class="text">測驗</span></a>
						</li>
					</ul>
				</div>
			<!--右下區域-->
				<div class="content-right">
					<div class="content-right-title">
						<span class="text-bold">課程公告</span>
					</div>
					<div class="hr"></div>
					<a id="add" href="addBoard.html"><span class="text go-add-btn pro-only">新增公告</span></a>
					<table class="content-tbl">
						<thead>
							<tr>
								<td>名稱</td><td>公布日期</td>
							</tr>
						</thead>
						<tbody id="boardList"></tbody>
					</table>
				</div>
			</div>
		</div>
		<!--modal-->
		<div class="modal-container do-not-show">
			<div class="modal-content">
				<div class="modal-header">
					<span class="board-name"></span>
					<span class="x-btn show-hide-modal cursor-pointer">x</span>
				</div>
				<div class="modal-body">
					<span class="course-name text-reminder"></span>
					<span class="update-time text-reminder"></span>
					<a id="edit" href="editboard.html"><span class="go-edit-btn pro-only cursor-pointer">修改公告</span></a><br>
					<br>
					<span class="board-detail"></span><br>
					<br>
					附件:<br><a id="attachment" href="#" download><span class="attachment"></span></a>
				</div>
			</div>
		</div>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script>
		var courseInfo = {
				name: "系統分析與設計",
				semester: "110-1",
				code: "IM3069*",
				division: "資管系",
				professor: "喵喵喵",
				credits: 3,
				description: "課程介紹課程介紹課程介紹課程介紹課程介紹課程介紹課程介紹課程介紹課程介紹"
		};
			$(".course-name").text(courseInfo.name);
			$(".course-semester").text(courseInfo.semester);
			$(".course-code").text(courseInfo.code);
			$(".course-division").text(courseInfo.division);
			$(".course-professor").text(courseInfo.professor);
			$(".course-credits").text(courseInfo.credits);
			$(".course-description").text(courseInfo.description);
	
			////////////判斷是教授還是學生/////////
			var userIsProfessor = 1;
			if(userIsProfessor){
				$(".stu-only").remove();
			}else{
				$(".pro-only").remove();
			}
	
	
	</script>
		<script>
			//////////////把資料塞進table裡////////////
var url_string = window.location.href;                
var url = new URL(url_string);
console.log(url);
var courseid = url.searchParams.get("CourseId");
getAllBoard()

document.getElementById("add").href = "addBoard.html?CourseId="+courseid;

function getAllBoard(){
    $.ajax({
        type: "GET",
        url: "api/BoardController",
        crossDomain: true,
        cache: false,
        data: "CourseId=" + courseid,
        dataType: 'json',
        timeout: 5000,
		// url可能是'../../../../Homework.ashx?Method=GetModuleInfo'之類的 額...可能
		//需要的資訊：這堂課的 HwName, HwEndingTime, HwScore
                           success: function (response) {
                                if(response.status == 200){
                                    updateTable(response.response.data);
                                }
                                console.log(response);
                            },
                            error: function () {
                                alert("無法連線到伺服器！");
                            }
    });
};


function deleteMember(id) {
    var check = window.confirm("確認刪除公告？");
    if (check == true) {
        console.log("You pressed OK!");
        var request = {'BoardId': id};
        var data_string = JSON.stringify(request);
        $.ajax({
            type: "DELETE",
            url: "api/BoardController",
            crossDomain: true,
            data: data_string,
            cache: false,
            dataType: 'json',
            timeout: 5000,
            success: function (response) {
                if(response.status == 200){
                    $("#flashMessage").html("成功! 已經成功刪除公告...");
                    $("#flashMessage").show();
                    location.reload();
                }
                console.log(response);
            },
            error: function () {
                alert("無法連線到伺服器！");
            }
        });
    }
}




			
function updateTable(data) {
    $("#table > tbody").empty();
    var table_html = '';
    $.each(data, function(index, value) {
        //table_html += '<tr><td scope="row">' + value['BoardId'] + '</td>';
        //table_html += '<tr><td>' + '<a href = "boarddetails.html?BoardId='+ value['BoardId']+'">'+ value['BoardName'] + '</a></td>';
        table_html += '<tr><td><a href="#"><span class="content-tbl-link show-hide-modal" id = "'+value['BoardId']+'">' + value['BoardName'] + '</span></a></td>';
        table_html += '<td>' + value['UpdateTime'] + '</td>';
        //table_html += '<td>' + value['login_times'] + '</td>';
        //table_html += '<td>' + value['status'] + '</td>';
        //table_html += '<td>' + '<a href="editboard.html?BoardId=' + value['BoardId'] + '&'+'CourseId='+value['CourseId'] + '">編輯</a> | ';
        table_html += '<td><a href="javascript: deleteMember(' + value['BoardId'] + ');">刪除</a></td></tr>';
    })

    $("#boardList").append(table_html);
    
    
    function getboard(id) {
        $.ajax({
          type: "GET",
          url: "api/BoardController",
          crossDomain: true,
          data: "BoardId=" + id,
          cache: false,
          dataType: 'json',
          timeout: 5000,
          success: function (response) {
            if (response.status == 200) {
          	
          	$.each(response.response.data, function (){ 
          		setBoard(this);
          	})
          	
            }
          },
          error: function () {
            alert("無法連線到伺服器！");
          }
        });
      }
      
    //getBoard();

    function setBoard(data) {
    	console.log(data);
    	$(".board-name").text(data.BoardName);
    	$(".board-detail").text(data.BoardDetails);
    	$(".attachment").text(data.Attachment);
    	document.getElementById("attachment").href = "statics/attachment/board/" + data.Attachment;
    	document.getElementById("edit").href = "editboard.html?CourseId="+data.CourseId+"&BoardId="+data.BoardId;
    	
    }
    
    $(".show-hide-modal").click(function(){
  	  $(".modal-container").toggleClass("do-not-show");
  	  //console.log(this.id);
  	  getboard(this.id);
  	});
}




// 參考網頁：https://www.dotblogs.com.tw/YiruAtStudio/2020/12/10/214043
// 沒有參考但是可以參考的網頁：https://iter01.com/158513.html

//$(".board-name").text("公告一");
//$(".board-detail").text("不管點哪一個都會是公告一");
//$(".attachment").text("board.pdf");

		</script>
	</body>
</html>